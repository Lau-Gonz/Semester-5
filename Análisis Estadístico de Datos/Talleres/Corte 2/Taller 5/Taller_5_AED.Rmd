---
title: "Taller 5 PCA"
author: "Dafne Castellanos, Diryon Mora, Fabio Rizo y Laura Gonzalez"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Matrix)
```

## Primer Punto

Determine the population principal components $Y_1$ and $Y_2$ for the covariance matrix. Also, calculate the proportion of the total population variance explained by the first principal component.

\begin{equation*}
\Sigma
=
\begin{pmatrix}
5 & 2 \\
2 & 2
\end{pmatrix}
\end{equation*}

```{r}
sigma = matrix(c(5,2,2,2), ncol=2);
eigenvectors = eigen(sigma)$vectors;
eigenvalues = eigen(sigma)$values; eigenvalues

Y1 = eigenvectors[, 1]; Y1
Y2 = eigenvectors[, 2]; Y2

variance_explained_sigma = eigenvalues[1] / sum(eigenvalues); variance_explained_sigma

```
Note que los valores propios de $\Sigma$ son $\lambda_1=6$,$\lambda_2=1$. Teniendo así las siguientes componentes:

$$ Y_1 = -0.8944272 X_1 -0.4472136X_2 $$

$$ Y_2 = 0.4472136X_1 -0.8944272X_2 $$
Luego, como $Var(Y_1)=\lambda_1=6$, la proporción de la varianza total de la problación explicaa por la primera componente es:

$$ Proportion = \frac{\lambda_1}{\Sigma\lambda_p}=0.8571429$$

## Segundo Punto

Convert the covariance matrix in Exercise 1 to a correlation matrix ρ .

```{r}
stddev = sqrt(diag(sigma))
rho = sigma / outer(stddev, stddev); rho
```

#### (a) Determine the principal components $Y_1$ and $Y_2$ from ρ and compute the proportion of total population variance explained by $Y_1$.

```{r}
eigenvalues = eigen(rho)$values;eigenvalues
eigenvectors = eigen(rho)$vectors
Y1 = eigenvectors[, 1]; Y1
Y2 = eigenvectors[, 2]; Y2
variance_explained_rho = eigenvalues[1] / sum(eigenvalues); variance_explained_rho
```
Se tienen las componentes:

$$ Y_1 = 0.7071068  Z_1 + 0.7071068 Z_2 $$

$$ Y_2 = -0.7071068Z_1 + 0.7071068Z_2 $$

Luego, como $Var(Y_1)=\lambda_1=1.6324555$, la proporción de la varianza total de la problación explicaa por la primera componente es:

$$ Proportion = \frac{\lambda_1}{\Sigma\lambda_p}=0.8162278$$
#### (b) Compare the components calculated in Part a with those obtained in Exercise 1. Are they the same? Should they be?

```{r}
variance_explained_sigma
variance_explained_rho
variance_explained_sigma == variance_explained_rho
```

No. Las dos variables (estandarizadas) contribuyen por igual a los componentes principales en 8.2(a). Las dos variables contribuyen de manera desigual a los componentes principales de 8.1 debido a sus varianzas desiguales. Serían igual sólo si las variables (diagonal de sigma) tuvieran la misma varianza.

#### (c) Compute the correlations $ρ_{Y_1,Z_1}$, $ρ_{Y_1,Z_2}$ and $ρ_{Y_2,Z_1}$.

```{r}
P_Y1_Z1 = eigenvectors[1, 1]*sqrt(eigenvalues[1]); P_Y1_Z1
P_Y1_Z2 = eigenvectors[2, 1]*sqrt(eigenvalues[1]); P_Y1_Z2
P_Y2_Z1 = eigenvectors[1, 2]*sqrt(eigenvalues[2]); P_Y2_Z1
```
Así, se tiene que: $ρ_{Y_1,Z_1}=0.9034532$, $ρ_{Y_1,Z_2}=0.9034532$ y $ρ_{Y_2,Z_1}=-0.4286866$

## Tercer Punto

Data on $x_1$ = sales and $x_2$ = profits for the 10 largest companies in the world were already listed. We know that:

\begin{equation*}
\hat{X}
=
\begin{pmatrix}
155.6 \\
14.7
\end{pmatrix}
\end{equation*}

\begin{equation*}
S
=
\begin{pmatrix}
7476.45 & 303.62 \\
303.62 & 26.19
\end{pmatrix}
\end{equation*}

```{r}
x_hat= matrix(c(155.60, 14.70), ncol=1);
s= matrix(c(7476.45, 303.62, 303.62, 26.19), ncol=2);
```

#### (a) Determine the sample principal components and their variances for these data. (You may need the quadratic formula to solve for the eigenvalues of S.)

```{r}
eigenvectors = eigen(s)$vectors;
eigenvalues = eigen(s)$values; eigenvalues
Y1 = eigenvectors[, 1]; Y1
Y2 = eigenvectors[, 2]; Y2
```
Se tienen las componentes:

$$ \hat{y_1} =-0.99917337  x_1 -0.04065185x_2 \\ Var(\hat{y_1})=7488.80293$$

$$ \hat{y_2} = 0.04065185x_1 -0.99917337x_2  \\ Var(\hat{y_2})=13.83707$$

#### (b) Find the proportion of the total sample variance explained by $\hat{y_1}$.

```{r}
variance_explained_sigma = eigenvalues[1] / sum(eigenvalues); variance_explained_sigma
```
$$ Proportion = \frac{\hat{\lambda_1}}{\Sigma\hat{\lambda_p}}=0.9981557$$

#### (c) Compute the correlation coefficients $r_{\hat{y_1},x_k}$, k = 1, 2. What interpretation, if any, can you give to the first principal component?

```{r}
r_y1_x1 = eigenvectors[1, 1]*sqrt(eigenvalues[1])/sqrt(s[1,1]); r_y1_x1
r_y1_x2 = eigenvectors[2, 1]*sqrt(eigenvalues[1])/sqrt(s[2,2]); r_y1_x2
```
Note que $r_{\hat{y_1},x_1}=-0.9999985$ y $r_{\hat{y_1},x_2}=-0.6874146$. Esto indica que el primer componente está casi totalmente determinado por $x_1$ = ventas, ya que su varianza es aproximadamente 542,66 veces la de $X_2$ = beneficios.
Así lo confirma el coeficiente de correlación r$r_{\hat{y_1},x_1}=-0.9999985$.

## Cuarto Punto

Convert the covariance matrix S in Exercise 3 to a sample correlation matrix R.

```{r}
stddev = sqrt(diag(s))
rho = s / outer(stddev, stddev); rho
```

#### (a) Find the sample principal components $\hat{y_1}$, $\hat{y_2}$ and their variances.

```{r}
eigenvalues = eigen(rho)$values;eigenvalues
eigenvectors = eigen(rho)$vectors
Y1 = eigenvectors[, 1]; Y1
Y2 = eigenvectors[, 2]; Y2
```

Se tienen las componentes:

$$ \hat{y_1} = 0.7071068 z_1 + 0.7071068z_2 \\ Var(\hat{y_1})=1.6861434 $$

$$ \hat{y_2} = -0.7071068z_1 + 0.7071068z_2  \\ Var(\hat{y_2})=0.3138566$$

#### (b) Compute the proportion of the total sample variance explained by $\hat{y_1}$.

```{r}
variance_explained_rho = eigenvalues[1] / sum(eigenvalues); variance_explained_rho
```

$$ Proportion = \frac{\hat{\lambda_1}}{\Sigma\hat{\lambda_p}}=0.8430717$$

#### (c) Compute the correlation coefficients $r_{\hat{y_1},x_k},k$ = 1, 2. Interpret $\hat{y_1}$.

```{r}

```

#### (d) Compare the components obtained in Part a with those obtained in Exercise 3 (a) do you feel that it is better to determine principal components from the sample covariance matrix or sample correlation matrix? Explain.

```{r}

```

## Quinto Punto

The weekly rates of return for five stocks listed on the New York Stock Exchange are given in Table 1 (stock data.DAT).

#### (a) Construct the sample covariance matrix S, and find the sample principal components. (Note that the sample mean vector x is displayed in Example 8.5.)

```{r}

```

#### (b)  Determine the proportion of the total sample variance explained by the first three principal components. Interpret these components.

```{r}

```

#### (c) Given the results in Parts a-b, do you feel that the stock rates-of-return data can be summarized in fewer than five dimensions? Explain.


```{r}

```

## Sexto Punto

Consider the census-tract data listed in Table 2 (census tract.DAT). Suppose the observations on $X_5$ = median value home were recorded in ten thousands, rather than hundred thousands, of dollars; that is, multiply all the numbers listed in the sixth column of the table by 10.

#### (a) Construct the sample covariance matrix S for the census-tract data when $X_5$ = median value home is recorded in ten thousands of dollars.

```{r}

```


#### (b) Obtain the eigenvalue-eigenvector pairs and the first two sample principal components for the covariance matrix in Part a.

```{r}

```

#### (c) Compute the proportion of total variance explained by the first two principal components obtained in Part b. Calculate the correlation coefficients, $r_{y_i,x_k}$, and interpret these components if possible.

```{r}

```

End